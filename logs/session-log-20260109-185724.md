# ShadowTree Session Log

**Date:** Friday, January 9, 2026
**Agent:** Gemini Interactive CLI Agent
**Objective:** Harden Shadowrocket configuration for US-based privacy-focused user.

---

## 1. Identity & Role
I am a specialized software engineering agent configured for codebase analysis and security hardening. My role in this session was to verify the initial project scaffolding and implement a robust, test-driven build pipeline that transforms a generic upstream Chinese configuration into a privacy-hardened, Western-centric security asset.

## 2. Key Changes

### A. Build Pipeline Implementation
*   **Action:** Verified and refined `scripts/build.sh` and `scripts/test.sh`.
*   **Rationale:** To maintain upstream compatibility with `LOWERTOP/Shadowrocket` while ensuring all custom privacy rules and DNS overrides are applied consistently and automatically.

### B. 2026 Threat Landscape Research
*   **Action:** Conducted deep-web research into current (January 2026) data harvesting trends.
*   **Rationale:** Standard blocklists from 2024/2025 are insufficient against the current "post-AI explosion" landscape.

### C. Strategic Filtering (The "Usability vs. Privacy" Balance)
*   **Action:** Explicitly decided *against* blocking primary AI domains (e.g., `openai.com`, `claude.ai`).
*   **Rationale:** The user confirmed active use of these services. Blocking the main API endpoints would break the apps. Instead, the focus was shifted to blocking **third-party telemetry** within those apps (Segment, Mixpanel, etc.) rather than the service itself.

### D. Ruleset Expansion
*   **Telemetry (`telemetry.list`):** Expanded to include 2025-2026 Smart TV endpoints for Samsung, LG, and Roku. Added `samba.tv` to stop aggressive cross-device correlation.
*   **Surveillance (`gov-surveillance.list`):** Added Hikvision, Dahua, and Verkada. Included Palantir Foundry product endpoints.
*   **Location Brokers (`location-brokers.list`):** Added mobility analytics firms like Unacast and Inrix that monetize movement data.

### E. Test-Driven Validation
*   **Action:** Updated `tests/rules/must_block.txt` with new 2026 targets.
*   **Rationale:** To provide objective proof that the configuration is actually blocking what it claims to block before it is deployed to the user's iPhone.

---

## 3. Rationale & Thinking

### The "Silent" Policy (`REJECT-DROP`)
I have prioritized `REJECT-DROP` for Government Surveillance and Data Brokers. Unlike a standard `REJECT` (which sends a 404 or connection reset), `REJECT-DROP` silently ignores the packet. This prevents the tracking server from even knowing the connection attempt was made, reducing the "signature" of the user's device on the network.

### Removing China-Specific Services
The upstream config is optimized for mainland China users. I sanitized the configuration by removing rules and proxy groups related to BiliBili, WeChat, and Chinese banks. 
*   **Thinking:** These rules are unnecessary for a US user and create potential fingerprinting vectors. By thinning the config, we reduce the attack surface and improve parsing speed on mobile hardware.

### DNS Integrity
Enforced Cloudflare (DoH) and Quad9 as the primary resolvers. 
*   **Thinking:** Quad9 provides an extra layer of protection by blocking known malicious domains at the DNS level before they even hit the local ruleset.

---
**Status:** All tests passing. Build artifact `dist/shadowtree.conf` is current and pushed to main.
